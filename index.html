<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iconbototos</title>
    <link rel="stylesheet" href="style.css">
 <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital@0;1&family=Oswald:wght@500;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
</head>
<body>

<ul class="menu">
    <li><a href="#obras">Obras</a></li>
    <li><a href="#tienda">Tienda</a></li>
    <li><a href="https://www.instagram.com/i_conbototos/?hl=es" target="_blank">IG @i_conbototos</a></li>
</ul>
    </nav>

<header class="hero">
    <div class="hero-content hidden">
        <h1 class="titulo-animado">Donde la <span>palabra</span> <br>toca la imagen.</h1>
        <p>Diseño Gráfico + Narrativa Contemporánea</p>
    </div>
</header>

    <section id="obras" class="galeria">
        <div class="obra-item hidden">
            <div class="obra-texto">
                <h2>El Susurro</h2>
                <p>"La ciudad no duerme, solo parpadea en neón..."</p>
                <span class="autor">- Texto: Mauro</span>
            </div>
            <div class="obra-visual">
                <img src="tu-foto.jpg" class="riso-img" alt="Arte riso">
            </div>
        </div>

        <div class="obra-item invertido hidden">
            <div class="obra-texto">
                </div>

            <div class="obra-visual">
                <img src="otra-foto.jpg" class="riso-img" alt="Arte riso 2">
            </div>
        </div>
    </section>

    <section id="tienda" class="tienda">
        <h2 class="section-title hidden">Adquiere Arte</h2>
        <div class="productos-grid">
            
            <div class="card-producto hidden">
                <div class="img-prod"></div>
                <h3>Lámina "Susurro"</h3>
                <p class="precio">$15.000 CLP</p>
                <a href="#" class="btn-comprar">Comprar</a>
            </div>

            <div class="card-producto hidden">
                <div class="img-prod"></div>
                <h3>Fanzine Vol. 1</h3>
                <p class="precio">$8.000 CLP</p>
                <a href="#" class="btn-comprar">Comprar</a>
            </div>

        </div>
    </section>

    <footer>
        <p>© 2026 Colectivo de Arte. Santiago, Chile.</p>
    </footer>

    <script src="https://sdk.mercadopago.com/js/v2"></script>

    <script>
      // 1. Inicializamos Mercado Pago con TU Public Key
      const mp = new MercadoPago('APP_USR-7ed5aea3-fb5c-413b-94a4-342cc1ce033c', {
        locale: 'es-CL'
      });

      // 2. Buscamos todos los botones que digan "btn-comprar"
      const botonesCompra = document.querySelectorAll('.btn-comprar');

      botonesCompra.forEach(boton => {
          boton.addEventListener('click', async function(e) {
              e.preventDefault(); // Evita que el link recargue la página o ponga #
              
              // Efecto visual: Cambiamos el texto para que el usuario sepa que está cargando
              const textoOriginal = this.innerText;
              this.innerText = "Procesando...";

              // Capturamos los datos del producto desde el HTML (DOM Traversal)
              // Buscamos el padre (.card-producto) y dentro de él, el h3 y el precio
              const tarjeta = this.closest('.card-producto');
              const tituloProducto = tarjeta.querySelector('h3').innerText;
              
              // Limpiamos el precio: "$15.000 CLP" -> 15000
              const textoPrecio = tarjeta.querySelector('.precio').innerText;
              const precioNumerico = parseInt(textoPrecio.replace(/\D/g, '')); 

              try {
                  // 3. Llamamos a TU servidor Python (Backend)
                  const response = await fetch("http://127.0.0.1:5000/crear_preferencia", {
                      method: "POST",
                      headers: { "Content-Type": "application/json" },
                      body: JSON.stringify({
                          titulo: tituloProducto, 
                          precio: precioNumerico 
                      }),
                  });

                  const data = await response.json();

                  // 4. Si Python nos devuelve un ID, abrimos la pasarela
                  if (data.id) {
                      mp.checkout({
                          preference: {
                              id: data.id
                          },
                          autoOpen: true, // ¡Magia! Esto abre el popup
                      });
                  } else {
                      alert("Error: El servidor no devolvió un ID de compra");
                  }
              } catch (error) {
                  console.error("Error:", error);
                  alert("No se pudo conectar con el servidor (Revisa que Python esté corriendo)");
              } finally {
                  // Pase lo que pase, devolvemos el botón a la normalidad
                  this.innerText = textoOriginal;
              }
          });
      });
    </script>
    <script src="main.js"></script>
</body>
</html>